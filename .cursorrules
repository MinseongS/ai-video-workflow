# AI YouTube 쇼츠 자동 생성 시스템 - Cursor Rules

## 프로젝트 개요

이 프로젝트는 라쿤 캐릭터 "넝심이"의 요리 쇼츠 영상을 매일 자동으로 생성하고 YouTube에 업로드하는 자동화 시스템입니다.

### 핵심 기능
- **AI 스토리 생성**: Google Gemini API를 사용하여 일관된 캐릭터와 스토리로 요리 영상 스토리 생성
- **AI 영상 생성**: Google Veo3 API를 사용하여 요리 영상 생성
- **자동 업로드**: YouTube Data API v3를 통해 쇼츠 영상 자동 업로드
- **일일 자동화**: n8n 워크플로우를 통해 매일 자동 실행
- **캐릭터 일관성**: 스토리 히스토리를 통해 주인공과 조연 캐릭터의 일관성 유지

### 주요 캐릭터
- **주인공**: 넝심이 - 살짝 너구리 같은 귀여운 라쿤 캐릭터, 요리를 좋아함
- **조연**: 조연캐릭터 - 넝심이의 친구, 항상 함께 등장하는 조연 캐릭터

## 프로젝트 구조

```
ai-youtube/
├── scripts/                    # 실행 스크립트들
│   ├── gemini-story-generator.js    # Gemini API 스토리 생성
│   ├── veo3-video-generator.js      # Veo3 영상 생성
│   ├── youtube-uploader.js          # YouTube 업로드
│   ├── daily-video-generator.js     # 전체 프로세스 통합
│   ├── merge-videos.js              # 영상 세그먼트 합치기
│   ├── youtube-auth-helper.js       # YouTube 인증 도우미
│   └── test-apis.js                 # API 테스트
├── workflows/                   # n8n 워크플로우
│   ├── daily-youtube-shorts.json           # 전체 기능 버전
│   └── daily-youtube-shorts-simple.json    # 간단한 버전 (권장)
├── data/                       # 데이터 파일 (자동 생성)
│   └── story-history.json      # 스토리 히스토리
├── output/                     # 출력 파일
│   └── videos/                 # 생성된 영상 파일
└── logs/                       # 로그 파일 (선택사항)
```

## 코딩 규칙 및 스타일

### 언어 및 런타임
- **Node.js**: 모든 스크립트는 Node.js로 작성
- **ES6+**: 최신 JavaScript 문법 사용
- **CommonJS**: `require`/`module.exports` 사용 (ES modules 아님)

### 코드 스타일
- **들여쓰기**: 2 spaces
- **따옴표**: single quotes (`'`) 사용
- **세미콜론**: 항상 사용
- **함수명**: camelCase
- **클래스명**: PascalCase
- **상수**: UPPER_SNAKE_CASE

### 파일 구조
- 각 스크립트는 독립적인 클래스로 구성
- 환경 변수는 `dotenv`를 통해 로드
- 에러 처리는 try-catch로 명시적으로 처리
- 로그는 `console.log`/`console.error` 사용

### API 통신
- **Gemini API**: `@google/generative-ai` 패키지 사용
- **Veo3 API**: `axios`를 사용한 HTTP 요청 (API 스펙 확인 필요)
- **YouTube API**: `googleapis` 패키지 사용

### 에러 처리
- 모든 API 호출은 try-catch로 감싸기
- 사용자에게 명확한 에러 메시지 제공
- 실패 시 적절한 기본값 반환 또는 재시도 로직 구현

### 환경 변수
- 모든 민감한 정보는 `.env` 파일에 저장
- `.env.example` 파일에 예시 제공
- 환경 변수는 `process.env`로 접근

## 주요 워크플로우

### 일일 영상 생성 프로세스
1. **스토리 히스토리 로드**: 이전 에피소드 정보 로드 (`data/story-history.json`)
2. **스토리 생성**: Gemini API로 새로운 스토리 생성 (캐릭터 일관성 유지)
3. **영상 생성**: Veo3 API로 여러 세그먼트 영상 생성
4. **영상 합치기**: ffmpeg를 사용하여 세그먼트들을 하나로 합치기
5. **YouTube 업로드**: 완성된 영상을 YouTube에 업로드 (#Shorts 태그 포함)
6. **히스토리 저장**: 스토리 정보를 히스토리에 저장

### n8n 워크플로우
- **간단한 버전**: `daily-video-generator.js` 스크립트를 직접 실행
- **전체 기능 버전**: 각 단계를 n8n 노드로 분리하여 실행

## 주의사항 및 제약사항

### API 제약사항
- **Veo3 API**: 아직 공개되지 않았을 수 있음. 실제 API 스펙에 맞게 코드 수정 필요
- **YouTube API**: 일일 할당량 제한 있음 (기본 10,000 units/day)
- **Gemini API**: 사용량에 따라 비용 발생

### 기술 요구사항
- **ffmpeg**: 영상 합치기를 위해 필수 (`brew install ffmpeg` 또는 `apt-get install ffmpeg`)
- **Node.js**: v16 이상 권장
- **n8n**: 자동화를 위해 필요 (선택사항)

### 파일 관리
- 생성된 영상 파일은 `output/videos/`에 저장
- 스토리 히스토리는 `data/story-history.json`에 저장
- `.gitignore`에 의해 영상 파일과 로그는 커밋되지 않음

## 개발 가이드

### 새로운 기능 추가 시
1. 관련 스크립트 파일 수정 또는 새 파일 생성
2. 필요한 환경 변수는 `env.example`에 추가
3. `README.md` 또는 `SETUP.md`에 문서화
4. 테스트 스크립트에 테스트 케이스 추가

### 스토리 생성 로직 수정 시
- `GeminiStoryGenerator` 클래스의 `buildPrompt` 메서드 수정
- 캐릭터 일관성을 유지하기 위해 히스토리 컨텍스트 활용
- 프롬프트는 한국어로 작성

### 영상 생성 로직 수정 시
- `Veo3VideoGenerator` 클래스 수정
- Veo3 API 스펙에 맞게 요청 형식 조정
- 프롬프트는 영어로 작성 (Veo3 API 요구사항)

### YouTube 업로드 로직 수정 시
- `YouTubeUploader` 클래스 수정
- OAuth 토큰 관리 주의
- 쇼츠 태그 및 메타데이터 설정 확인

## 테스트

### API 테스트
```bash
npm test
# 또는
node scripts/test-apis.js
```

### 수동 실행 테스트
```bash
npm start
# 또는
node scripts/daily-video-generator.js
```

### YouTube 인증 테스트
```bash
npm run auth:youtube
# 또는
node scripts/youtube-auth-helper.js
```

## 환경 변수 목록

필수 환경 변수:
- `GEMINI_API_KEY`: Google Gemini API 키
- `VEO3_API_KEY`: Google Veo3 API 키
- `VEO3_PROJECT_ID`: Google Cloud 프로젝트 ID
- `YOUTUBE_CLIENT_ID`: YouTube API 클라이언트 ID
- `YOUTUBE_CLIENT_SECRET`: YouTube API 클라이언트 시크릿
- `YOUTUBE_REFRESH_TOKEN`: YouTube API 리프레시 토큰
- `YOUTUBE_CHANNEL_ID`: YouTube 채널 ID

선택적 환경 변수:
- `MAIN_CHARACTER_NAME`: 주인공 이름 (기본값: "넝심이")
- `MAIN_CHARACTER_DESCRIPTION`: 주인공 설명
- `SUPPORTING_CHARACTER_NAME`: 조연 이름
- `SUPPORTING_CHARACTER_DESCRIPTION`: 조연 설명
- `N8N_API_KEY`: n8n API 키
- `N8N_BASE_URL`: n8n 기본 URL

## Git 규칙

- 커밋 메시지는 한국어 또는 영어로 작성
- 주요 기능 추가/수정 시 의미 있는 커밋 메시지 작성
- `.env` 파일은 절대 커밋하지 않음
- 생성된 영상 파일도 커밋하지 않음

## 참고 문서

- `README.md`: 프로젝트 개요 및 사용법
- `SETUP.md`: 상세한 설정 가이드
- `env.example`: 환경 변수 예시

## AI 어시스턴트를 위한 가이드

코드를 수정하거나 새 기능을 추가할 때:
1. 기존 코드 스타일을 유지하세요
2. 에러 처리를 명시적으로 추가하세요
3. 환경 변수 사용 시 `env.example`도 업데이트하세요
4. 한국어 주석과 로그 메시지를 사용하세요
5. API 호출 시 적절한 타임아웃과 재시도 로직을 고려하세요
6. Veo3 API는 아직 공개되지 않았을 수 있으므로, 모의 응답이나 대체 로직을 고려하세요
